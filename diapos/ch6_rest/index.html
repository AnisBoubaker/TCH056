<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>CH05- REST | TCH056</title>

    <link rel="stylesheet" href="../revealjs/reset.css" />
    <link rel="stylesheet" href="../revealjs/reveal.css" />
    <link rel="stylesheet" href="../revealjs/theme/ets.css" id="theme" />
    <link rel="stylesheet" href="../revealjs/theme/normalize.css" />
    <link rel="stylesheet" href="./css/examples_general.css" />
    <link rel="stylesheet" href="./css/examples.css" />
    <link rel="stylesheet" href="../timeline/css/timeline.min.css" />
    <link rel="stylesheet" href="./ch4.css" />
    <link rel="stylesheet" href="../jqtree.css" />

    <!-- Theme used for syntax highlighted code -->
    <link
      rel="stylesheet"
      href="../revealjs/plugin/highlight/docco.css"
      id="highlight-theme"
    />

    <script src="../jquery-3.6.4.min.js"></script>
  </head>
  <body>
    <!--
					
		-->
    <div class="reveal">
      <div id="slide_nb" style="display: none">Attention...</div>
      <div class="titre_cours">TCH056 - Programmation Web</div>
      <div class="slides">
        <section>
          <img src="../images/logo_ets.png" />
          <h4 class="">TCH056 - Programmation Web</h4>
          <h2 class="r-fit-text">Chapitre 06: Les APIs REST</h2>
          <br /><br />
          <p>
            <strong>Anis Boubaker, Ph.D.</strong><br />
            <em>Prof. Enseignant en informatique</em>
          </p>
        </section>

        <!-- Plan du chapitre -->
        <section data-transition="convex">
          <h2>Plan du chapitre</h2>
          <div class="two_columns_layout">
            <div class="col menu-principal">
              <ul class="">
                <li class="plan-current">Introduction à REST</li>
                <li>Conception d'une API REST</li>
                <li>Communication avec une API REST</li>
                <li>REST avec PHP</li>
                <li>Routage</li>
                <li>Authentification et sécurité</li>
              </ul>
            </div>
            <div class="col sous-menu">
              <ul style="margin: 0">
                <li>Définition</li>
                <li>Autres types d'API</li>
                <li>Principes de base</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Diapositive 2: Définition et importance des API -->
        <section>
          <h2>Qu'est-ce qu'une API ?</h2>
          <p>API signifie Interface de Programmation d'Application.</p>
          <p>Elles permettent la communication entre différents logiciels.</p>
          <p>
            <b>Exemple :</b> L'API de Twitter permet d'intégrer ses
            fonctionnalités dans d'autres applications.
          </p>
        </section>

        <section>
          <h2>Une API offre des services</h2>
          <image src="./images/rest-offre-services.webp" style="width: 600px" />
        </section>

        <!-- Diapositive 3: Différence entre API REST et autres types d'API -->
        <section>
          <section>
            <h2>API REST</h2>
            <p>REST signifie Representational State Transfer.</p>
            <p>
              Utilise des requêtes HTTP pour GET, POST, PUT, DELETE des données.
            </p>
            <p><b>Exemple :</b> API RESTful de GitHub.</p>
          </section>
          <section>
            <h2>API SOAP</h2>
            <p>SOAP signifie Simple Object Access Protocol.</p>
            <p>Basé sur XML, plus strict et sécurisé.</p>
            <p><b>Exemple :</b> Service web de Microsoft Exchange.</p>
          </section>
          <section>
            <h2>API GraphQL</h2>
            <p>GraphQL est une alternative à REST.</p>
            <p>
              Offre aux clients de demander exactement les données dont ils ont
              besoin.
            </p>
            <p>
              Évite les problèmes de surcharges de données (overfetching) ou des
              demandes de données insuffisantes (underfetching)
            </p>
            <p><b>Exemple :</b> API de GitHub v4.</p>
          </section>
        </section>

        <!-- Diapositive 1: Architecture sans état (Stateless) -->
        <section>
          <h2>Architecture sans état (Stateless)</h2>
          <p>Chaque requête de l'API REST est indépendante des autres.</p>
          <p>
            Le serveur ne stocke pas d'informations sur l'état du client entre
            les requêtes.
          </p>
          <p>
            <b>Exemple :</b> Une requête GET pour récupérer des données ne
            dépend pas des requêtes précédentes.
          </p>
        </section>

        <!-- Diapositive 2: Utilisation des méthodes HTTP -->
        <section>
          <h2>Utilisation des méthodes HTTP</h2>
          <ul>
            <li><b>GET</b> - Récupérer des données.</li>
            <li><b>POST</b> - Créer une nouvelle ressource.</li>
            <li><b>PUT</b> - Mettre à jour une ressource existante.</li>
            <li><b>DELETE</b> - Supprimer une ressource.</li>
          </ul>
          <p><b>Exemple :</b> POST /users pour créer un nouvel utilisateur.</p>
        </section>

        <section>
          <h2>Requête REST: Méthode + Ressource</h2>
          <img src="./images/rest-api.png" />
          <p class="note">Source: mannhowie.com</p>
        </section>

        <section>
          <h2>Indépendante du langages ou de la plateforme</h2>
          <p>Une API REST permet d'intéragir avec la couche métier:</p>
          <ul>
            <li>Peu importe l'interface usager (Web, mobile, desktop)</li>
            <li>
              Peu importe la technologie sous jacente (langage de programmation,
              cadriciels, etc.)
            </li>
          </ul>
        </section>

        <section>
          <h2>Une API Universelle</h2>
          <img src="./images/api_universelle.webp" style="width: 600px" />
        </section>

        <section>
          <h2>Standards Ouverts</h2>
          <ul>
            <li>La communication se fait à travers le prototcole HTTP</li>
            <li>
              Les données sont échangées en utilisant des formats largement
              supportés comme JSON (principalement) ou XML.
            </li>
          </ul>
        </section>

        <!-- Plan du chapitre -->
        <section data-transition="convex">
          <h2>Plan du chapitre</h2>
          <div class="two_columns_layout">
            <div class="col menu-principal">
              <ul class="">
                <li class="plan-visted">Introduction à REST</li>
                <li class="plan-current">Conception d'une API REST</li>
                <li>Communication avec une API REST en JS</li>
                <li>REST avec PHP</li>
                <li>Routage</li>
                <li>Authentification et sécurité</li>
              </ul>
            </div>
            <div class="col sous-menu">
              <ul style="margin: 0">
                <li>Ressources et URI</li>
                <li>Formats de réponses</li>
                <li>Planification</li>
                <li>Bonnes pratiques</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Diapositive 3: Structure des URL et des ressources -->
        <section>
          <h2>Structure des URL et des ressources</h2>
          <p>
            Les URL identifient les ressources, et la structure des URL doit
            être logique et prévisible.
          </p>
          <p>
            <b>Exemple :</b> GET /users/123 pour récupérer l'utilisateur avec
            l'ID 123.
          </p>
          <p>
            Les ressources sont souvent organisées en collections et éléments.
          </p>
        </section>

        <!-- Diapositive 4: Formats de réponse -->
        <section>
          <h2>Formats de réponse</h2>
          <p>
            Les API REST peuvent retourner des données dans différents formats.
          </p>
          <ul>
            <li>
              <b>JSON</b> (JavaScript Object Notation) - Format léger et facile
              à lire.
            </li>
            <li>
              <b>XML</b> (eXtensible Markup Language) - Plus verbeux, utilisé
              dans les systèmes plus anciens.
            </li>
          </ul>
          <p>
            Le format JSON est davantage utilisé que le format XML (interprété
            nativement par JavaScript)
          </p>
        </section>

        <!-- Diapositive: Exemple de Réponse JSON avec une Liste d'Utilisateurs -->
        <section>
          <h2>Exemple de Réponse JSON</h2>
          <p>
            Voici comment une API REST pourrait retourner une liste
            d'utilisateurs en format JSON :
          </p>
          <pre><code class="json" data-trim contenteditable>
          {
          "users": [
            {
              "id": 1,
              "name": "Alice Dupont",
              "email": "alice.dupont@example.com",
              "role": "admin"
            },
            {
              "id": 2,
              "name": "Bob Martin",
              "email": "bob.martin@example.com",
              "role": "user"
            },
            {
              "id": 3,
              "name": "Charlie Nom",
              "email": "charlie.nom@example.com",
              "role": "user"
            }
          ]
          }
          </code></pre>
        </section>

        <!-- Diapositive: Exemple de Réponse XML avec une Liste d'Utilisateurs -->
        <section>
          <h2>Exemple de Réponse XML</h2>
          <p>
            Voici comment une API REST pourrait retourner une liste
            d'utilisateurs en format XML :
          </p>
          <pre><code class="xml" data-trim contenteditable>
          &lt;users&gt;
            &lt;user&gt;
                &lt;id&gt;1&lt;/id&gt;
                &lt;name&gt;Alice Dupont&lt;/name&gt;
                &lt;email&gt;alice.dupont@example.com&lt;/email&gt;
                &lt;role&gt;admin&lt;/role&gt;
            &lt;/user&gt;
            &lt;user&gt;
                &lt;id&gt;2&lt;/id&gt;
                &lt;name&gt;Bob Martin&lt;/name&gt;
                &lt;email&gt;bob.martin@example.com&lt;/email&gt;
                &lt;role&gt;user&lt;/role&gt;
            &lt;/user&gt;
            &lt;user&gt;
                &lt;id&gt;3&lt;/id&gt;
                &lt;name&gt;Charlie Nom&lt;/name&gt;
                &lt;email&gt;charlie.nom@example.com&lt;/email&gt;
                &lt;role&gt;user&lt;/role&gt;
            &lt;/user&gt;
          &lt;/users&gt;
          </code></pre>
        </section>

        <!-- Diapositive 1: Planification des Ressources -->
        <section>
          <h2>Planification des Ressources</h2>
          <p>
            Identifier les principales entités de l'application (ex:
            utilisateurs, articles, commentaires).
          </p>
          <p>Chaque entité devient une ressource dans l'API.</p>
          <p>Exemples :</p>
          <ul>
            <li>Utilisateurs (users)</li>
            <li>Articles (articles)</li>
            <li>Commentaires (comments)</li>
          </ul>
        </section>

        <!-- Diapositive 2: Définition des Routes et Méthodes -->
        <section>
          <h2>Définition des Routes et Méthodes</h2>
          <p>Créer des routes pour interagir avec les ressources.</p>
          <p>
            Utiliser les méthodes HTTP appropriées (GET, POST, PUT, DELETE).
          </p>
          <p>Exemples de routes :</p>
          <pre><code>
          GET /users - Récupérer la liste des utilisateurs
          POST /users - Créer un nouvel utilisateur
          GET /users/{id} - Récupérer un utilisateur spécifique
          PUT /users/{id} - Mettre à jour un utilisateur
          DELETE /users/{id} - Supprimer un utilisateur
          </code></pre>
        </section>

        <!-- Diapositive 3: Bonnes Pratiques - Naming Conventions -->
        <section>
          <h2>Bonnes Pratiques: Conventions de nommage</h2>
          <p>Utiliser des noms clairs et cohérents pour les routes.</p>
          <p>Préférer le pluriel pour les noms de ressources.</p>
          <p>
            Exemple : /users pour les utilisateurs, /articles pour les articles.
          </p>
        </section>

        <!-- Diapositive 4: Bonnes Pratiques - Versioning -->
        <section>
          <h2>Bonnes Pratiques: Versioning</h2>
          <ul>
            <li>
              Inclure la version de l'API dans l'URL pour faciliter les mises à
              jour futures.
            </li>
            <li>Utiliser la technique du versionnage sémantique</li>
          </ul>
          <p>Exemple : /v1.1.0/users, /v2.2.1/users</p>
        </section>

        <!-- Diapositive 5: Bonnes Pratiques - Sécurité -->
        <section>
          <h2>Bonnes Pratiques: Sécurité</h2>
          <p>Assurer la sécurité des données et des communications.</p>
          <ul>
            <li>Utiliser HTTPS pour chiffrer les données en transit.</li>
            <li>Authentification (ex: OAuth, JWT).</li>
            <li>
              Validation et nettoyage des entrées pour prévenir les injections
              SQL.
            </li>
          </ul>
        </section>

        <!-- Diapositive 6: Bonnes Pratiques - Gestion des Erreurs -->
        <section>
          <h2>Bonnes Pratiques: Gestion des Erreurs</h2>
          <p>Fournir des messages d'erreur clairs et informatifs.</p>
          <ul>
            <li>Utiliser des codes d'état HTTP appropriés.</li>
            <li>
              Messages d'erreur en format JSON avec code d'erreur, message et
              éventuellement des détails.
            </li>
          </ul>
        </section>

        <!-- Diapositive 7: Bonnes Pratiques - Documentation -->
        <section>
          <h2>Bonnes Pratiques: Documentation</h2>
          <p>Une documentation complète et à jour est cruciale.</p>
          <ul>
            <li>
              Utiliser des outils comme Swagger ou Redoc pour créer une
              documentation interactive.
            </li>
            <li>Inclure des exemples de requêtes et de réponses.</li>
          </ul>
        </section>

        <!-- Diapositive 8: Bonnes Pratiques - Performance -->
        <section>
          <h2>Bonnes Pratiques: Performance</h2>
          <p>
            Optimiser la performance de l'API pour une meilleure expérience
            utilisateur.
          </p>
          <ul>
            <li>Mise en cache des réponses lorsque c'est possible.</li>
            <li>Limitation (rate limiting) pour prévenir l'abus de l'API.</li>
            <li>
              Utilisation de techniques de pagination pour les grandes
              collections de données.
            </li>
          </ul>
        </section>

        <!-- Diapositive 9: Bonnes Pratiques - Scalabilité -->
        <section>
          <h2>Bonnes Pratiques: Scalabilité</h2>
          <p>
            Concevoir l'API pour qu'elle puisse gérer l'augmentation du trafic.
          </p>
          <ul>
            <li>
              Architecture microservices pour faciliter la montée en charge.
            </li>
            <li>
              Équilibrage de charge et utilisation de serveurs de réplication.
            </li>
          </ul>
        </section>

        <!-- Plan du chapitre -->
        <section data-transition="convex">
          <h2>Plan du chapitre</h2>
          <div class="two_columns_layout">
            <div class="col menu-principal">
              <ul class="">
                <li class="plan-visited">Introduction à REST</li>
                <li class="plan-visited">Conception d'une API REST</li>
                <li class="plan-current">Communication avec une API REST</li>
                <li>REST avec PHP</li>
                <li>Routage</li>
                <li>Authentification et sécurité</li>
              </ul>
            </div>
            <div class="col sous-menu">
              <ul style="margin: 0">
                <li>Accès à une API REST</li>
                <li>Communication asynchrone avec l'API</li>
              </ul>
            </div>
          </div>
        </section>

        <section>
          <h2>Accès à une API REST</h2>
          <p>
            Tous les langages de programmation qui permettent la communication à
            travers le port HTTP permettent de ce connecter à une API REST.
          </p>
          <p>
            Lors de la conception d'une API REST, plusieurs outils permettent
            d'y accéder aux fins de tests:
          </p>
          <ul>
            <li>Postman</li>
            <li>Insomnia</li>
            <li>Thunder Client (VS Code)</li>
            <li>...</li>
          </ul>
        </section>

        <section>
          <h2>Exemples d'APIs librement accessibles</h2>
          <ul>
            <li>
              <a href="https://openweathermap.org/api">OpenWeatherMap</a>:
              Données météorologiques globales (prévidions + historiques)
            </li>
            <li>
              <a href="https://developers.themoviedb.org/3"
                >The Movie Database</a
              >: Base de données communautaire de films et de séries TV
            </li>
            <li>
              <a href="https://jokeapi.dev">JokeAPI</a>: Blagues dans diverses
              catégories
            </li>
            <li>
              <a href="https://api.nasa.gov/">NASA API</a>: Accès à une
              multitude de données spatiales, y compris des images de la NASA,
              des informations sur les missions, et plus encore.
            </li>
            <li>
              <a href="https://randomuser.me">Random User Generator</a>: Utile
              pour générer des profils d'utilisateurs fictifs pour des tests ou
              des maquettes
            </li>
          </ul>
        </section>

        <section>
          <h2>Communication REST avec Javascript</h2>
          <p>
            Pour ne pas bloquer la pile d'exécution, les communications avec une
            API se font de façon asynchrone.
          </p>
          <p class="fragment">
            Plusieurs méthodes permettent la communication HTTP asynchrone
            (notamment avec une API REST):
          </p>
          <ul>
            <li class="fragment">
              L'objet XMLHttpRequest: Objet disponible dans tous les navigateurs
              depuis IE5 (1999)
            </li>
            <li class="fragment">
              Plusieurs librairies: Comme jQuery (généraliste) et Axios
              (spécifique aux requêtes)
            </li>
            <li class="fragment">
              La fonction <code>fetch</code>: Méthode moderne implantée dans
              tous les navigateurs contemporains
            </li>
          </ul>
        </section>

        <section>
          <h2>La fonction <code>fetch</code></h2>
          <ul>
            <li>
              <code>fetch</code> utilise les 'Promesses' qui est un mécanisme
              d'exécution des fonctions de façon asynchrone
            </li>
            <li>
              Une requête HTTP se fait en deux étapes avec fetch:
              <pre><code class="javascript" data-trim>
                fetch("URI", { ...options })
                  .then((response)=>{
                    //fonction de rappel qui traite la réponses HTTP 
                    //et retourne les données (fonction asynchrone)
                  })
                  .then((data)=>{
                    //fonction de rappel pour traiter les données 
                  })
                  .catch((error)=>{
                    //fonction de rappel pour traiter les erreurs 
                    //éventuelles. 
                  })
              </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h2>Exemple avec <code>fetch</code> (GET)</h2>
          <pre><code class="javascript" data-trim>
            fetch("https://jsonplaceholder.typicode.com/posts/3", 
                  { method: "GET" })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Erreur HTTP: " + response.statusText);
              }
              return response.json();
            })
            .then((data) => {
              if (data.error)
                throw new Error("Erreur reçue du serveur: " + data.error);

              console.log(data);
            })
            .catch((error) =>
              console.error(
                "Il y'a eu une erreur lors de l'obtention des données:" +
                  error.message
              )
            );
          </code></pre>
        </section>

        <section>
          <h2>Exemple avec <code>fetch</code> (POST)</h2>
          <pre><code class="javascript" data-trim>
            fetch('https://jsonplaceholder.typicode.com/posts', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                title: 'Mon post',
                body: 'Je teste si mon post sera stocké',
                userId: 1,
              }),
            })
            .then(response => {
              if (!response.ok) {
                throw new Error('Erreur reçue du serveur'+response.statusText);
              }
              return response.json();
            })
            .then(data => console.log(data))
            .catch(error => console.error('Il y a eu une erreur:', error.message));
          </code></pre>
        </section>

        <section>
          <h2>Exemple avec <code>fetch</code> (PUT)</h2>
          <pre><code class="javascript" data-trim>
            // L'URL de l'API pour le post avec l'ID 1
            const url = 'https://jsonplaceholder.typicode.com/posts/1';

            // Les données que nous souhaitons mettre à jour
            const data = {
              id: 1, // Normalement, vous n'avez pas besoin de fournir 
                     // l'ID dans le corps pour une requête PUT, 
                     //mais JSONPlaceholder l'exige pour la simulation.
              title: 'Nouveau titre',
              body: 'Nouveau contenu',
              userId: 1,
            };

            // Options de la requête fetch pour effectuer une opération PUT
            const fetchOptions = {
              method: 'PUT', // Méthode HTTP utilisée
              headers: {
                // Indique que le corps de la requête est au format JSON
                'Content-Type': 'application/json', 
              },
              // Convertit les données de l'objet JavaScript en chaîne JSON
              body: JSON.stringify(data), 
            };

            // Effectuer la requête PUT
            fetch(url, fetchOptions)
              .then(response => {
                if (!response.ok) {
                  // Si la réponse n'est pas dans la plage de succès HTTP (200-299),
                  // lance une erreur avec le statut pour indiquer l'échec de la requête
                  throw new Error('Le serveur a renvoyé une erreur');
                }
                return response.json(); // Parse la réponse en JSON
              })
              .then(updatedPost => {
                console.log('Post mis à jour:', updatedPost); // Affiche les données du post mis à jour
              })
              .catch(error => {
                console.error("Il y a eu une error lors de l'opération fetch:", error);
              });

          </code></pre>
        </section>

        <!-- Plan du chapitre -->
        <section data-transition="convex">
          <h2>Plan du chapitre</h2>
          <div class="two_columns_layout">
            <div class="col menu-principal">
              <ul class="">
                <li class="plan-visited">Introduction à REST</li>
                <li class="plan-visited">Conception d'une API REST</li>
                <li class="plan-visited">Communication avec une API REST</li>
                <li class="plan-current">Conception d'une API REST avec PHP</li>
                <li>Authentification et sécurité</li>
              </ul>
            </div>
            <div class="col sous-menu">
              <ul style="margin: 0"></ul>
            </div>
          </div>
        </section>

        <section data-menu-title="Fin">
          <img src="../images/the_end.png" />
        </section>
      </div>
    </div>

    <script src="../revealjs/reveal.js"></script>
    <script src="../revealjs/plugin/notes/notes.js"></script>
    <script src="../revealjs/plugin/markdown/markdown.js"></script>
    <script src="../revealjs/plugin/highlight/highlight.js"></script>
    <script src="../revealjs/plugin/menu/menu.js"></script>

    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,
        slideNumber: true,
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealMenu],

        menu: {
          side: "left",
          width: "wide", //'normal', 'wide', 'third', 'half', 'full', or css valid length
          numbers: false,
          titleSelector: "h1, h2, h3, h4, h5, h6",
          useTextContentForMissingTitles: true,
          hideMissingTitles: false,
          markers: true,
          custom: false,
          themes: false,
          themesPath: "dist/theme/",
          transitions: false,
          openButton: true,
          openSlideNumber: false,
          keyboard: true,
          sticky: false,
          autoOpen: true,
          delayInit: false,
          openOnInit: false,
          loadIcons: true,
        },
      });
    </script>
    <script src="../timeline/js/timeline.min.js"></script>
    <script>
      timeline(document.querySelectorAll(".timeline"));

      Reveal.on("slidechanged", (event) => {
        // event.previousSlide, event.currentSlide, event.indexh, event.indexv
        let panel = document.getElementById("slide_nb");
        if (event.currentSlide.classList.contains("slidenb")) {
          panel.textContent = event.currentSlide.dataset.slidenb;
          panel.style.display = "block";
        } else {
          panel.style.display = "none";
        }
      });
    </script>
    <script src="../tree.jquery.js"></script>
    <script src="./ch4.js"></script>
  </body>
</html>
